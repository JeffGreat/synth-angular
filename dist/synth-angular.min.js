!function(a,b,c){"use strict";angular.module("synthAngular.syForm",["ngResource"]),angular.module("synthAngular.syForm",[]).provider("syFormDefaultValue",function(){var a={horizontal:!0,inline:!1,form_message_container:c,form_message_error:{enabled:!1,message:"Your form contains errors"},form_message_success:{enabled:!1,message:"operation successful"},input_message:{enabled:!0,error:"invalid input"},data_loading_text:"saving..."};this.get=function(){return a},this.set=function(b){return a=angular.extend({},a,b)},this.$get=function(){return{get:this.get,set:this.set}}}),angular.module("synthAngular.syForm").directive("syForm",["$q","syFormDefaultValue","$compile",function(a,b,d){return{restrict:"A",require:["form"],scope:{syForm:"=?syForm",sySubmit:"&"},controller:["$scope","$element","$attrs",function(a,c,d){this.options=angular.extend(b.get(),a.syForm),this.options.horizontal&&c.addClass("form-horizontal"),this.options.inline&&c.addClass("form-inline")}],link:function(e,f,g,h){function i(a){var b=$("[type=submit]",f);1==a&&(e.text=b[0].textContent,b[0].textContent=l.data_loading_text,b[0].disabled=!0),0==a&&(b[0].textContent=e.text,b[0].disabled=!1)}function j(b){e.$apply(function(){if(!k.$submitting){i(!0);var c=a.when(e.$parent.$eval(e.sySubmit));c.then(function(a){e.showFormMessage("success")},function(a){e.resetFormError(),e.setServerErrors(a),e.showFormMessage("danger")})["finally"](function(a){i(!1)})}b.preventDefault()})}var k=h[0],l=angular.extend(b.get(),e.syForm);e.resetFormError=function(){k.$error={}},e.setServerErrors=function(a){var b=e.compileErrors(a);angular.forEach(b,function(a,b){angular.isDefined(k[b])&&angular.forEach(a,function(a,c){k[b].$error[c]=a})})},e.compileErrors=function(a){var b={};return angular.forEach(a,function(a,d){if("string"==typeof a)b[d]==c?b[d]=[a]:b[d].push(a);else if("object"==typeof a){var f=e.compileErrors(a);angular.forEach(f,function(a,d){b[d]==c?b[d]=a:b[d].concat(a)})}}),b},e.showFormMessage=function(a){var b={};b=angular.element(l.form_message_container==c?'form[name="'+k.$name+'"]':l.form_message_container);var f="";"success"==a&&l.form_message_success.enabled?f='<br/><alert type="'+a+'" close="close()" >'+l.form_message_success.message+"</alert>":l.form_message_error.enabled&&(f='<br/><alert type="'+a+'" close="close()" >'+l.form_message_error.message+"</alert>"),b.after(d(f)(e))},f.on("submit",j),e.$on("destroy",function(){f.off("submit",j)})}}}]),angular.module("synthAngular.syForm").directive("syFormGroup",[function(){return{restrict:"AE",transclude:!0,replace:!0,require:["^syForm"],scope:{inputLabel:"@",inputClass:"@",labelClass:"@"},templateUrl:"syForm/sy-form-group.tpl.html",controller:["$scope",function(a){a.hasError=!1,this.setError=function(b){a.hasError=b}}],link:function(a,b,c,d){a.syForm=d[0],a.syForm.options.horizontal?(c.inputClass=c.inputClass||"col-sm-9",c.labelClass=c.labelClass||"col-sm-3"):a.syForm.options.inline?(c.inputClass=c.inputClass||"form-group",c.labelClass=c.labelClass||""):a.syForm.options.inline||a.syForm.options.multiline||(c.inputClass=c.inputClass||"",c.labelClass=c.labelClass||"")}}}]),angular.module("synthAngular.syForm").directive("syFormInput",["$compile",function(a){return{restrict:"A",require:["^syForm","^syFormGroup","^form","?^syValidationSchema"],priority:1e3,link:function(b,d,e,f){b.syForm=f[0],b.syformGroup=f[1],b.form=f[2],b.syValidationSchema=f[3],b.showErrors=function(){return b.syForm.options.input_message.enabled&&b.inputVar.$dirty?!0:!1},d.addClass("form-control");var g=e.name;b.inputVar=b.form[g];var h='<span ng-if="showErrors()" class="help-block" ng-repeat="(validator, error) in inputVar.$error" ng-bind="getErrorMessage(validator)"></span>';d.after(h),a(d.next())(b),b.getErrorMessage=function(a){return angular.isString(b.inputVar.$error[a])?b.inputVar.$error[a]:b.syValidationSchema?b.syValidationSchema.getFieldErrorMessage(g,a):b.syForm.options.input_message.error},b.$watch("inputVar.$error",function(a){b.syformGroup.setError(b.showErrors()&&a!=c&&Object.keys(a).length>0?!0:!1)},!0)}}}]);var d=angular.module("synthAngular.syList",["ngResource","ui.router","infinite-scroll"]);d.directive("syList",["$state",function(a){var b={title:"list",fields:[],actions:[],headerActionsTitle:"actions",headerActions:[]};return{restrict:"AE",transclude:!0,scope:{listElements:"=",title:"@",options:"=syListOptions",customSearch:"=",scrollAction:"@"},templateUrl:"syList/sy-list.tpl.html",controller:function(a){a.options=angular.extend({},b,a.options),a.listElements,a.scroll=function(){a.scrollAction&&a.$eval(a.scrollAction)}}}}]),d.directive("syListCell",["$compile","$state","$templateCache",function(a,b,c){return{restrict:"A",require:["^syList"],scope:{cell:"=syListCell"},link:function(b,d,e,f){b.item=b.$parent.item;var g=b.item[b.cell.property];if(b.cell.template){var h=b.cell.template;d.html(a(h)(b))}else if(b.cell.templateUrl){var h=c.get(b.cell.templateUrl);d.html(a(h)(b))}else if(g&&b.cell.url){var h='<a ui-sref="'+b.cell.url+'">'+g+"</a>";d.html(a(h)(b))}else g&&d.html(g)},controller:function(a){}}}]),angular.module("synthAngular.syValidation",[]),angular.module("synthAngular.syValidation",[]).provider("syValidatorSchema",function(){var a={required:{error:"this field is required"},maxlength:{error:"input field too long",attrname:"ng-maxlength"},minlength:{error:"input field too short",attrname:"ng-minlength"}};this.add=function(b,c){a[b]=c},this.get=function(b){return a[b]},this.getAttributeName=function(b){return a[b]&&a[b].attrname?a[b].attrname:b},this.$get=function(){return{set:this.set,get:this.get,getAttributeName:this.getAttributeName}}}),angular.module("synthAngular.syValidation").provider("syEntitySchema",function(){var a={};this.set=function(b,c){a[b]=c},this.get=function(b){return a[b]},this.$get=function(){return{set:this.set,get:this.get}}}),angular.module("synthAngular.syValidation").directive("syValidationSchema",["syEntitySchema","syValidatorSchema",function(a,b){var c={$global:{success:"your form has been successfully submitted.",error:"An error occured, please review all fields and submit the form again."},$default:{error:"this field is not valid"}};return{restrict:"A",require:["form"],controller:["$scope","$element","$attrs",function(d,e,f){var g=a.get(f.syValidationSchema);g=angular.extend({},c,g),this.schema=g,this.getFieldErrorMessage=function(a,c){var d=this.schema[a];return d=angular.extend({},this.schema.$default,b.get(c),d[c]),d.error}}],compile:function(d,e){var f=a.get(e.syValidationSchema);if(f){f=angular.extend({},c,f);var g=d[0].querySelectorAll("input,select,textarea");angular.forEach(g,function(a){var c=angular.element(a),d=c.attr("name");f[d]&&angular.forEach(f[d],function(a,d){var e=b.getAttributeName(d);a.value?c.attr(e,a.value):c.attr(e,!0)})})}else console.warn("syValidationSchema: invalid entity schema")}}}]);var e=angular.module("synthAngular",["ngResource","angularFileUpload"]);e.provider("$apiManager",function(){var a="api/rest/:service/:id/:sub_service/:sub_id",b={id:"@id",service:"@service",sub_id:"@sub_id",sub_service:"@service"};this.setApiParams=function(a){b=a},this.setBaseApiUrl=function(b){a=b},this.$get=["$resource",function(c){return c(a,b,{list:{method:"GET",isArray:!0},save:{method:"POST"},update:{method:"POST"},remove:{method:"POST"},get:{method:"GET",isArray:!1}})}]}),e.service("$uiManager",["$apiManager","$filter","$collectionManager","$sockets","syTools","$q",function(a,b,d,e,f,g){this.defaults={collection:c,form:c,search:{},publish_to_socket:!1,show_form_message:!1},this.queryParams={},this.getItems=function(b,c){var e=g.defer(),f=angular.extend({},this.defaults,c),h=angular.extend({},this.queryParams,{offset:0,service:b},f.search);return a.list(h,function(a){f.collection&&d.addItems(c.collection,a),e.resolve(a)},function(a){e.reject(a)}),e.promise},this.createItem=function(b,c,f){var h=g.defer(),i=angular.extend({},this.defaults,c),j=angular.extend({},this.queryParams,{service:b},i.search);return i.socket_service||(i.socket_service=b?b:""),a.save(j,f,function(a){d.addItem(i.collection,a),i.publish_to_socket&&e.publish(i.socket_service,i.socket_operation||"add",a),h.resolve(a)},function(a){delete f._method,h.reject(a)}),h.promise},this.updateItem=function(b,c,d){var h=g.defer(),i=angular.extend({},this.defaults,c),j=angular.extend({},this.queryParams,{service:b,id:d.id},i.search);return i.socket_service||(i.socket_service=b?b:""),d._method="put",a.update(j,d,function(a){delete d._method,f.mergeResourceProperties(d,a),i.publish_to_socket&&e.publish(i.socket_service,i.socket_operation||"update",a),h.resolve(a)},function(a){delete d._method,h.reject(a)}),h.promise},this.deleteItem=function(b,c,f){var h=g.defer(),i=angular.extend({},this.defaults,c),j=angular.extend({},this.queryParams,{service:b,id:f.id},i.search);i.socket_service||(i.socket_service=b?b:"");var k=f.id;return f._method="delete",a.remove(j,f,function(a){delete f._method,d.deleteItem(i.collection,k),i.publish_to_socket&&e.publish(i.socket_service,i.socket_operation||"delete",k),h.resolve(a)},function(a){h.reject(a)}),h.promise},this.getScrollItems=function(c,e){var f=g.defer(),h=angular.extend({},this.defaults,e),i=angular.extend({},this.queryParams,{offset:b("filter")(e.collection,h.search,!0).length,service:c},h.search);return d.disableLoading(h.collection,h.tag),a.list(i,function(a){d.disableLoading(h.collection,h.tag),d.addItems(h.collection,a),f.resolve(a)},function(a){f.reject(a)}),f.promise}}]),e.filter("findItem",["$filter",function(a){return function(b,c){var d=a("filter")(b,{id:c},!0);return d.length>0?d[0]:null}}]),e.factory("syTools",function(){var a={mergeResourceProperties:function(a,b){for(var d in b)"$"!=d.substr(0,1)&&(a[d]=b[d]);for(var d in a)"$"!=d.substr(0,1)&&b[d]==c&&delete a[d]},generateRoute:function(a,b,c){return c=1==c?c:!1,Routing.generate(a,b,c)}};return a}),e.service("$sockets",function(){this.session=c,this.clank=c,this.connect=function(a){this.clank=Clank.connect(a),this.clank.parent=this,this.clank.on("socket/connect",function(a){this.parent.session=a})},this.unsubscribeAll=function(){if(this.session)for(index in this.session._subscriptions)this.session.unsubscribe(index)},this.subscribeSocket=function(a,b,c){if(this.topic=b,this.session)for(index=0;index<a.length;++index)this.session.subscribe(this.topic+a[index],function(a,b){c(b)})},this.publish=function(a,b,c){angular.isDefined(this.session)&&angular.isDefined(a)&&this.session.publish(this.topic+a,{operation:b,data:c,service:a})}}),e.service("$collectionManager",["$filter","syTools",function(a,b){this.addItem=function(c,d){if(c&&d){var e=a("findItem")(c,d.id);null==e?c.push(d):b.mergeResourceProperties(e,d)}},this.addItems=function(a,b){if(a&&b){var c=this;angular.forEach(b,function(b){c.addItem(a,b)})}},this.deleteItem=function(b,c){if(b&&c){var d=a("findItem")(b,c);null!=d&&b.splice(b.indexOf(d),1)}},this.disableLoading=function(a,b){a&&b&&(!angular.isDefined(a.scroll)&&b&&(a.scroll=[]),b&&1==a.scroll[b]||b&&(a.scroll[b]=!0))},this.enableLoading=function(a,b){a&&b&&angular.isDefined(a.scroll)&&angular.isDefined(angular.scroll[b])&&(a.scroll[b]=!1)},this.isLoading=function(a,b){return a&&b&&angular.isDefined(a.scroll)&&1==a.scroll[b]?!0:!1}}]),e.factory("uploadFile",["$upload","$sockets",function(a,b){return a}])}(window,document);